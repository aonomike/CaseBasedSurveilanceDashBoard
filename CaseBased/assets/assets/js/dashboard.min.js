var blue="#348fe2",blueLight="#5da5e8",blueDark="#1993E4",aqua="#49b6d6",aquaLight="#6dc5de",aquaDark="#3a92ab",green="#00acac",greenLight="#33bdbd",greenDark="#008a8a",orange="#f59c1a",orangeLight="#f7b048",orangeDark="#c47d15",dark="#2d353c",grey="#b6c2c9",purple="#727cb6",purpleLight="#8e96c5",purpleDark="#5b6392",red="#ff5b57",pink="#D108A3",handleVectorMap=function(){"use strict";0!==$("#world-map").length&&$("#world-map").vectorMap({map:"world_mill_en",scaleColors:["#e74c3c","#0071a4"],normalizeFunction:"polynomial",hoverOpacity:.5,hoverColor:!1,markerStyle:{initial:{fill:"#4cabc7",stroke:"transparent",r:3}},regionStyle:{initial:{fill:"rgb(97,109,125)","fill-opacity":1,stroke:"none","stroke-width":.4,"stroke-opacity":1},hover:{"fill-opacity":.8},selected:{fill:"yellow"},selectedHover:{}},focusOn:{x:.5,y:.5,scale:0},backgroundColor:"#2d353c",markers:[{latLng:[41.9,12.45],name:"Vatican City"},{latLng:[43.73,7.41],name:"Monaco"},{latLng:[-.52,166.93],name:"Nauru"},{latLng:[-8.51,179.21],name:"Tuvalu"},{latLng:[43.93,12.46],name:"San Marino"},{latLng:[47.14,9.52],name:"Liechtenstein"},{latLng:[7.11,171.06],name:"Marshall Islands"},{latLng:[17.3,-62.73],name:"Saint Kitts and Nevis"},{latLng:[3.2,73.22],name:"Maldives"},{latLng:[35.88,14.5],name:"Malta"},{latLng:[12.05,-61.75],name:"Grenada"},{latLng:[13.16,-61.23],name:"Saint Vincent and the Grenadines"},{latLng:[13.16,-59.55],name:"Barbados"},{latLng:[17.11,-61.85],name:"Antigua and Barbuda"},{latLng:[-4.61,55.45],name:"Seychelles"},{latLng:[7.35,134.46],name:"Palau"},{latLng:[42.5,1.51],name:"Andorra"},{latLng:[14.01,-60.98],name:"Saint Lucia"},{latLng:[6.91,158.18],name:"Federated States of Micronesia"},{latLng:[1.3,103.8],name:"Singapore"},{latLng:[1.46,173.03],name:"Kiribati"},{latLng:[-21.13,-175.2],name:"Tonga"},{latLng:[15.3,-61.38],name:"Dominica"},{latLng:[-20.2,57.5],name:"Mauritius"},{latLng:[26.02,50.55],name:"Bahrain"},{latLng:[.33,6.73],name:"São Tomé and Príncipe"}]})},handleBarChart=function(a,b){"use strict";0!==$(b).length&&$.plot(b,[{data:a,color:purple}],{series:{bars:{show:!0,barWidth:.4,align:"center",fill:!0,fillColor:purple,zero:!0}},xaxis:{mode:"categories",tickColor:"#ddd",tickLength:0},grid:{borderWidth:0}})},handleInteractiveChart=function(a,b,c,d,e){"use strict";var f="/CaseBased/Dashboard/get_gender_based_yearly_event_distribution";0!==$("#interactive-chart").length&&getPlotData(a,b,c,d,e,f)},getPlotData=function(a,b,c,d,e,f){var g=0,h=[],i=[],j=[],k=[],l=[],m=[],n=0,o=0;return $.post(f,{facility:a,start_date:b,end_date:c,county:d,event_id:e},function(a){for(n=parseInt(a[0].YEAR),o=parseInt(a[a.length-1].YEAR),$.each(a,function(){if(this.EVENT_COUNT>g&&(g=parseInt(this.EVENT_COUNT)+200),"MALE"==this.Sex||"Male"==this.Sex){var a=new Array;k.push(this.YEAR),a.push(this.YEAR),a.push(this.EVENT_COUNT),h.push(a)}else if("FEMALE"==this.Sex||"Female"==this.Sex){var b=new Array;l.push(this.YEAR),b.push(this.YEAR),b.push(this.EVENT_COUNT),i.push(b)}});o>=n;){var d=[];if(d.push(n),d.push(n),j.push(d),k.indexOf(n.toString())==-1){var e=[];e.push(n),e.push(0),h.push(e)}if(l.indexOf(n.toString())==-1){var f=[];f.push(n),f.push(0),i.push(f)}h=h.sort(function(a,b){return a[0]-b[0]}),i=i.sort(function(a,b){return a[0]-b[0]}),n++}m=[{data:h,label:"Males",color:blue,lines:{show:!0,fill:!1,lineWidth:2},points:{show:!0,radius:3,fillColor:"#fff"},shadowSize:0},{data:i,label:"Females",color:red,lines:{show:!0,fill:!1,lineWidth:2},points:{show:!0,radius:3,fillColor:"#fff"},shadowSize:0}],plotInteractiveChart(m,j,g)},"json"),m},bindInteractiveChart=function(){var a=function(a,b,c){$('<div id="tooltip" class="flot-tooltip">'+c+"</div>").css({top:b-45,left:a-55}).appendTo("body").fadeIn(200)},b=null;$("#interactive-chart").bind("plothover",function(c,d,e){if($("#x").text(d.x.toFixed(2)),$("#y").text(d.y.toFixed(2)),e){if(b!==e.dataIndex){b=e.dataIndex,$("#tooltip").remove();var f=e.datapoint[1].toFixed(2),g=e.series.label+" "+f;a(e.pageX,e.pageY,g)}}else $("#tooltip").remove(),b=null;c.preventDefault()})},showTooltip=function(a,b,c){$('<div id="tooltip" class="flot-tooltip">'+c+"</div>").css({top:b-45,left:a-55}).appendTo("body").fadeIn(200)},plotInteractiveChart=function(a,b,c){var d=function(a,b,c){$('<div id="tooltip" class="flot-tooltip">'+c+"</div>").css({top:b-45,left:a-55}).appendTo("body").fadeIn(200)},f=($.plot($("#interactive-chart"),a,{xaxis:{ticks:b,tickDecimals:0,tickColor:"#ddd"},yaxis:{ticks:10,tickColor:"#ddd",min:0,max:c},grid:{hoverable:!0,clickable:!0,tickColor:"#ddd",borderWidth:1,backgroundColor:"#fff",borderColor:"#ddd"},legend:{labelBoxBorderColor:"#ddd",margin:10,noColumns:1,show:!0}}),null);$("#interactive-chart").bind("plothover",function(a,b,c){if($("#x").text(b.x.toFixed(2)),$("#y").text(b.y.toFixed(2)),c){if(f!==c.dataIndex){f=c.dataIndex,$("#tooltip").remove();var e=c.datapoint[1].toFixed(2),g=c.series.label+" "+e;d(c.pageX,c.pageY,g)}}else $("#tooltip").remove(),f=null;a.preventDefault()})},eventChange=function(){$("#existing-events").change(function(){var a=$("#start-date").val(),b=$("#end-date").val(),c=$("#county").val(),d=$("#facility").val(),e=$("#existing-events").val();handleInteractiveChart(d,a,b,c,e)})},facilityChange=function(){$("#facility").change(function(){var a=$("#start-date").val(),b=$("#end-date").val(),c=$("#county").val(),d=$("#facility").val(),e=$("#existing-events").val();getCountyByFacilityCode(d),getPopulationSeekingCareByAge(d,a,b,c),getTotalNumberOfPatientsWithEvents(d,a,b,c),getReportBasedOnVariousIndicators(d,a,b,c),getEventSummaryStatistics(d,a,b,c),handleInteractiveChart(d,a,b,c,e),get_90_90_90(d,a,b,c),getGenderBasedEventDistribution(d,a,b,c)})},countyChange=function(){$("#county").change(function(){var a=$("#start-date").val(),b=$("#end-date").val(),c=$("#county").val(),d=$("#facility").val(),e=$("#existing-events").val();console.log(c),getPopulationSeekingCareByAge(d,a,b,c),getFacilityByCounty(c),getTotalNumberOfPatientsWithEvents(d,a,b,c),getReportBasedOnVariousIndicators(d,a,b,c),getEventSummaryStatistics(d,a,b,c),handleInteractiveChart(d,a,b,c,e),get_90_90_90(d,a,b,c),getGenderBasedEventDistribution(d,a,b,c)})},startDateChange=function(){$("#start-date").change(function(){var a=$("#start-date").val(),b=$("#end-date").val(),c=$("#county").val(),d=$("#facility").val();getPopulationSeekingCareByAge(d,a,b,c),getTotalNumberOfPatientsWithEvents(d,a,b,c),getReportBasedOnVariousIndicators(d,a,b,c),getEventSummaryStatistics(d,a,b,c),handleInteractiveChart(d,a,b,c)})},endDateChange=function(){$("#start-date").change(function(){var a=$("#start-date").val(),b=$("#end-date").val(),c=$("#county").val(),d=$("#facility").val();getPopulationSeekingCareByAge(d,a,b,c),getTotalNumberOfPatientsWithEvents(d,a,b,c),getReportBasedOnVariousIndicators(d,a,b,c),getEventSummaryStatistics(d,a,b,c)})},handleInteractivePieChart=function(a,b,c){"use strict";if(0!==$("#interactive-pie-chart").length){for(var d=[],e=2,f=0;f<e;f++)d[f]={label:c[f],data:a[f],color:b[f]};$.plot($("#interactive-pie-chart"),d,{series:{pie:{show:!0}},grid:{hoverable:!0,clickable:!0},legend:{labelBoxBorderColor:"#ddd",backgroundColor:"none"}})}},handleDonutChart=function(a){"use strict";if(0!==$("#donut-chart").length){for(var b=[],c=2,d=[blue,purpleDark],e=["Males Positive","Females Positive"],f=0;f<c;f++)b[f]={label:e[f],data:a[f],color:d[f]};$.plot($("#donut-chart"),b,{series:{pie:{innerRadius:.5,show:!0,combine:{color:"#999",threshold:.1}}},grid:{borderWidth:0,hoverable:!0,clickable:!0},legend:{show:!1}})}},handleStackedChart=function(a){"use strict";function i(a,b,c){$('<div id="tooltip" class="flot-tooltip">'+c+"</div>").css({top:b,left:a+35}).appendTo("body").fadeIn(200)}for(var b=[],c=[],d=[],e=0,f=0;f<a.length;f++)"MALE"===a[f].gender||"Male"===a[f].gender?(b.push([e,a[f].event_count]),d.push([e,a[f].verbose_name]),e++):"Female"!==a[f].gender&&"FEMALE"!==a[f].gender||c.push([e,a[f].event_count]);var g={xaxis:{tickColor:"transparent",ticks:d},yaxis:{tickColor:"#ddd",ticksLength:10},grid:{hoverable:!0,tickColor:"#ccc",borderWidth:0,borderColor:"rgba(0,0,0,0.2)"},series:{stack:!0,lines:{show:!1,fill:!1,steps:!1},bars:{show:!0,barWidth:.5,align:"center",fillColor:null},highlightColor:"rgba(0,0,0,0.8)"},legend:{show:!0,labelBoxBorderColor:"#ccc",position:"ne",noColumns:1}},h=[{data:b,color:blue,label:"Male",bars:{fillColor:blue}},{data:c,color:red,label:"Female",bars:{fillColor:red}}];$.plot("#stacked-chart",h,g);var j=null,k=null;$("#stacked-chart").bind("plothover",function(a,b,c){if(c){var d=c.datapoint[1]-c.datapoint[2];j==c.series.label&&d==k||(j=c.series.label,k=d,$("#tooltip").remove(),i(c.pageX,c.pageY,d+" "+c.series.label))}else $("#tooltip").remove(),j=null,k=null})},handleDashboardSparkline=function(){"use strict";function b(){var b=[50,30,45,40,50,20,35,40,50,70,90,40];a.type="line",a.height="23px",a.lineColor=red,a.highlightLineColor=red,a.highlightSpotColor=red;var c=$("#sparkline-unique-visitor").width();c>=200?a.width="200px":a.width="100%",$("#sparkline-unique-visitor").sparkline(b,a),a.lineColor=orange,a.highlightLineColor=orange,a.highlightSpotColor=orange,$("#sparkline-bounce-rate").sparkline(b,a),a.lineColor=green,a.highlightLineColor=green,a.highlightSpotColor=green,$("#sparkline-total-page-views").sparkline(b,a),a.lineColor=blue,a.highlightLineColor=blue,a.highlightSpotColor=blue,$("#sparkline-avg-time-on-site").sparkline(b,a),a.lineColor=grey,a.highlightLineColor=grey,a.highlightSpotColor=grey,$("#sparkline-new-visits").sparkline(b,a),a.lineColor=dark,a.highlightLineColor=dark,a.highlightSpotColor=grey,$("#sparkline-return-visitors").sparkline(b,a)}var a={height:"50px",width:"100%",fillColor:"transparent",lineWidth:2,spotRadius:"4",highlightLineColor:blue,highlightSpotColor:blue,spotColor:!1,minSpotColor:!1,maxSpotColor:!1};b(),$(window).on("resize",function(){$("#sparkline-unique-visitor").empty(),$("#sparkline-bounce-rate").empty(),$("#sparkline-total-page-views").empty(),$("#sparkline-avg-time-on-site").empty(),$("#sparkline-new-visits").empty(),$("#sparkline-return-visitors").empty(),b()})},handleDashboardDatepicker=function(){"use strict";$("#datepicker-inline").datepicker({todayHighlight:!0})},handleDashboardTodolist=function(){"use strict";$("[data-click=todolist]").click(function(){var a=$(this).closest("li");$(a).hasClass("active")?$(a).removeClass("active"):$(a).addClass("active")})},handleDashboardGritterNotification=function(){$(window).load(function(){setTimeout(function(){$.gritter.add({title:"Welcome back, Admin!",text:"Thank You for Visiting Us",sticky:!0,time:"",class_name:"my-sticky-class"})},10)})},getGenderBasedYearlyEventDistribution=function(){var a="",b="",c="",d="",e="/CaseBased/Dashboard/get_population_infected_and_seeking_care_summary";$.post(e,{facility:a,start_date:b,end_date:c,county:d},function(a){},"json")},getTotalNumberOfPatientsWithEvents=function(a,b,c,d){var e="/CaseBased/Dashboard/get_total_person_counts_with_events";$.post(e,{facility:a,start_date:b,end_date:c,county:d},function(a){$("#patient-count").html(a.total_person_count)},"json")},getEventSummaryStatistics=function(a,b,c,d){var e="/CaseBased/Dashboard/get_event_counts_per_event";$.post(e,{facility:a,start_date:b,end_date:c,county:d},function(a){var b=0,c="";a?($.each(a,function(){b+=parseInt(this.event_count)}),$.each(a,function(){var a=parseInt(this.event_count)/b*100;a=Math.round(10*a)/10,c+='<tr class="gradeA"><td>'+this.verbose_name+"</td><td>"+this.event_count+"</td><td>"+a+"</td></tr>"}),$("#summary-detail").html(c),$("#number-of-events").html(b)):$("#summary-detail").html("")},"json")},getReportBasedOnVariousIndicators=function(a,b,c,d){var e="/CaseBased/Dashboard/get_report_based_on_various_indicators";$.post(e,{facility:a,start_date:b,end_date:c,county:d},function(a){var b="",c=a.MALES_EVER_POSITIVE,d=a.FEMALES_EVER_POSITIVE,e=a.GENDER_UNKNOWN_EVER_POSITIVE,f=a.TOTAL_EVER_POSITIVE,g=a.MALES_EVER_ON_ARV,h=a.FEMALES_EVER_ON_ARV,i=a.GENDER_UNKNOWN_EVER_ON_ARV,j=a.TOTAL_NUMBER_EVER_ON_ARV,k=a.NUMBER_WITH_CD4_COUNT_OVER_500,l=a.NUMBER_WITH_CD4_COUNT_BELOW_500,m=a.NUMBER_WITH_CD4_COUNT,n=a.NUMBER_WITH_VIRAL_LOAD_OVER_1000,o=a.NUMBER_WITH_VIRAL_LOAD_BELOW_1000,p=a.NUMBER_WITH_VIRAL_LOAD,q=a.NUMBER_DEAD,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=[c,d];handleDonutChart(B);var C=[l,k],D=[green,grey],E=[l+" cd4 counts below 500",k+" cd4 counts Over 500"];handleInteractivePieChart(C,D,E),f>0&&(c&&(r=100*c/f,r=Math.round(10*r)/10),d&&(s=100*d/f,s=Math.round(10*s)/10),e&&(t=100*e/f,t=Math.round(10*t)/10)),j>0&&(g&&(u=calculatePercentage(g,j)),h&&(v=calculatePercentage(h,j)),i&&(w=calculatePercentage(i,j))),m>0&&(k&&(x=calculatePercentage(k,m)),l&&(y=calculatePercentage(l,m))),p>0&&(n&&(z=calculatePercentage(n,p)),o&&(A=calculatePercentage(o,p))),$("#male-count").html(c),$("#female-count").html(d);var F=calculatePercentage(q,f),b="<tr><td> HIV POSITIVE </td><td>Males</td><td><p>"+c+"</p></td>";b+="<td>"+r+"</td></tr><tr><td></td><td>Females</td><td ><p >"+d+"</p></td>",b+='<td id="percentage-female-positive"> <p>'+s+"</p></td></tr>",b+="<tr><td></td><td>Unknown Gender</td><td><p>"+e+"</p></td></tr>",b+="<tr><td> </td> <td>Totals</td><td><p>"+f+"</p></td><td>100 </td>",b+="</tr><tr><td> NUMBER ON ARVS </td><td>Males</td><td><p>"+g+"</p></td>",b+="<td><p>"+u+"</p></td></tr><tr><td></td><td>Females</td>",b+="<td><p >"+h+"</p></td><td> <p>"+v+"</p></td>",b+="</tr><tr><td></td><td>Unknown Gender</td><td><p>"+i+"</p></td>",b+="<td><p>"+w+"</p></td></tr><tr><td></td><td>Totals</td><td><p>"+j+"</p></td>",b+="<td>100</td></tr><tr><td> POPULATION WITH CD4 COUNT </td><td> <=500 cell/mm3</td><td><p>"+l+"</p></td>",b+="<td><p>"+y+"</p></td></tr><tr><td></td><td> >500 cell/mm3 </td>",b+="<td><p>"+k+"</p></td><td><p>"+x+"</p></td></tr><tr>",b+="<td></td><td>Totals</td><td><p>"+m+"</p></td><td> 100 </td></tr>",b+="<tr><td> POPULATION WITH HIGH VIRAL LOAD </td><td><=1000cp/ml</td><td><p>"+o+"</p></td>",b+="<td><p>"+A+"</p></td><tr><td></td><td> >1000cp/ml</td>",b+="<td><p>"+n+"</p></td><td><p>"+z+"</p></td>",b+="</tr><tr><td></td><td>Total </td><td><p>"+p+"</p></td><td> 100</td>",b+="</tr><tr><td> POPULATION CONFIRMED DEAD </td><td>Number Dead </td><td><p>"+q+"</p></td>",b+="<td>"+F+"</td></tr>",$("#indicators").html(b)},"json")},getPopulationSeekingCareByAge=function(a,b,c,d){var e="/CaseBased/Dashboard/get_population_infected_and_seeking_care_summary",f=[];$.post(e,{facility:a,start_date:b,end_date:c,county:d},function(a){var b="",c=0;a&&($.each(a,function(){c+=parseInt(this.number_seeking_care)}),$.each(a,function(){var a=calculatePercentage(this.number_seeking_care,c),d=[];d.push(this.age_range),d.push(a),f.push(d),handleBarChart(f,"#bar-chart"),b+='<tr class="gradeA"><td>'+this.age_range+"</td><td>"+this.number_seeking_care+"</td><td>"+a+" </td></tr> "}),$("#population").html(b))},"json")},getGenderBasedEventDistribution=function(a,b,c,d){var e="/CaseBased/Dashboard/get_gender_based_event_distribution";$.post(e,{facility:a,start_date:b,end_date:c,county:d},function(a){handleStackedChart(a)},"json")},calculatePercentage=function(a,b){var c=100*parseInt(a)/parseInt(b);return c=Math.round(10*c)/10},getFacilityByCounty=function(a){var b="/CaseBased/Dashboard/get_facilities_by_county";$.post(b,{county:a},function(a){var b="<option></option>";$.each(a,function(){b+="<option value='"+this.mflcode+"'>"+this.facilityname+" -"+this.mflcode+"</option>"}),$("#facility").html(b)},"json")},getCountyByFacilityCode=function(a){var b="/CaseBased/Dashboard/get_county_by_facility_code";$.post(b,{facility_code:a},function(a){$("#county").val(a.county)},"json")},get_90_90_90=function(a,b,c,d){var e="/CaseBased/Dashboard/get_diagnosis_vs_initiation_vs_vl_suppression",f=[];$.post(e,{facility:a,start_date:b,end_date:c,county:d},function(a){console.log(a),f.push(["Total Number",a.total_count],["Initiated To ART",a.number_initiated_to_care],["Viral Load < 1000",a.vl_below_1000]),handleBarChart(f,"#bar")},"json")},refreshEventPage=function(){setInterval(function(){county=$("#county").val(),startDate=$("#start-date").val(),endDate=$("#end-date").val(),facility=$("#facility").val(),eventId=$("#existing-events").val(),getPopulationSeekingCareByAge(facility,startDate,endDate,county),getEventSummaryStatistics(facility,startDate,endDate,county),getTotalNumberOfPatientsWithEvents(facility,startDate,endDate,county),getReportBasedOnVariousIndicators(facility,startDate,endDate,county),get_90_90_90(facility,startDate,endDate,county),getGenderBasedEventDistribution(facility,startDate,endDate,county)},3e4)},Dashboard=function(){"use strict";return{init:function(){var a="",b="",c="",d="",e=12;refreshEventPage(),facilityChange(),countyChange(),eventChange(),getReportBasedOnVariousIndicators(a,b,c,d),handleInteractiveChart(a,b,c,d,e),getPopulationSeekingCareByAge(a,b,c,d),get_90_90_90(a,b,c,d),getGenderBasedEventDistribution(a,b,c,d),$("#existing-events").val(12),handleDashboardSparkline(),handleDashboardTodolist(),handleVectorMap(),handleDashboardDatepicker(),handleBarChart()}}}();